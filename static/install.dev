#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
