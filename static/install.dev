#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
