#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
