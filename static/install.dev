#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
