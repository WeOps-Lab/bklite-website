#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
