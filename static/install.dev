#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
