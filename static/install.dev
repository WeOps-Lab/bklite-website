#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
