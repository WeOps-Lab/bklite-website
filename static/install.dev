#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
