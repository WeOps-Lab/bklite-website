#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
