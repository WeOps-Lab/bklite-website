#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
