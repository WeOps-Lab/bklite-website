#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
H4sIAFJab2kAA+09bXvcxLV81q8YFqeJAe2bvU7YZFM2603i4ti+3nVTalw92pW8FtFKi6R1YoyfB9pSEiCElgItTS/QQtvbe0m45T6kJQT+TNZOPvUv3DMvkkbSaL3OW+9toxZndebMmTNnzpw5M3NmlM09ct+ffD5/sFRC5N8p+m++OEn/ZQ8qlAoTE1MTpYOlKZQvFCYKU4+g0v1n7ZFH+q6nOsCK7hjtYXiAtro6JJ3VI/j3/8mTzWl2+4zuyG2727NdPbuhds17XAbIY2pyMq39C8WDpQJr/8niwcJBaP9SoVB6BOXvMR/C51+8/S3dO2s7Z9yyhJCmr+N/4IdjrOtOGbUcQ+vokrRum/2uTnAcXTPID0v1yL/rRtuzHUOVu7oHIiQwUCSv4+jRdNPuEMCqap6xHa2Ff3cNy7DLkuTqDuDRDG3T7muyoemUF6OrdnRg5YxpeHouSCRpurWurBomw0RIRlkAkReOZZaSa9vWaq6tO8B3Tvfa7Kdj+6QMx7a6uuX5eWrz0/VGffH79UVlodponJ5fnC6jsU0BeIvlmF+oz+HkCH4CSLF7tuNx7FG6ysL8YnOrfCh/KE9S+NaheNBGfCsE8hnbnJ6vPQM8zZyqnqgri/XpmQYtCNoBNNwrI9U8q264YulQgjlN9VQCA2vQVS0tRMgQDBk3lO5kQrAsO/oLfcPRe6rrcvCxTcJCWGmatqarprfWXtPbZ3zaHvBXRsuZ2qnpzJN+OW3TwC/yGv5r2m3VXAOdIqAe/js1cfAp8qbiv8nCANgzrE5mhRViWB5wrpplNJF3/YKNrm73oexCAHKwDoNc0MQQ8XPKnyb+uWpzL9Jnuompkj9Z/EqVNAZj2ipWaIIb0WqMR3glaSktK7e5dhMUmhkuC5EBSJPL92dqzfnFmapyqt5cnKntRUaJYnJxiDxEe2XZBVxgaRpwFlRvrSLOHtHsNc/rzRqup1tVTXMq+Sz5X/nQZPFQrAcAimfY1gIMIrZWKUwdWuMRuuq5WbWlmy6kN0HpoBOBklUm8vlhosW/NL2nW5qr2FY50p5SzMimyXthvtE8sVhnchbYOB9BWQKTVg5oxlN5e5YA+tZv4cR0tVktI2JFchFSidYMmBcgc8rtw3MwTnhaK+u+YJZ9hwVq4Wz0bOjZMkvVOLRdBLu7Hep1FMN1dFXbIHZmidqZiLzmqqfqWwITU0iamFKKhUmqvmjI3K07zc6fGNKV0qWQ3slIybl1/I+4Rwn6U4BM0uGtozvHbaerepXnXdsKkwwLeoCXxd3CsPSG8aJ+bAOkXymwyYAUegbpdT81Mzczn15pga6THMri/HyTafvYZgy0lcTkNV8A3opIB9HhkfYAJINPbbm2qcsqmA/ddVGm/BT4uxmx7GmNwyH4bpS33XdMorar+C+2Y+VcDhxtYsEKmIt8jpSXo7RyVNFXiOTNVdM+O1T0s8dn509viRWDZg9eqUTCtpfxOB68MpPKJWO3KDSdhVLeN5I0uaVC37c0on263HeMhEV5wXyi52607V6nCHUO7IzIbj0dpJYmJ4q5GOeyDDplrKptD4YGEK8Bhtfg1NidAPo0T4iZ47KTqodJIlVFpL8Pa2uBHsuoerqhVGu1eqOhPFN/VpmZrqSqMkVu1GuL9SaXpzJEm/1M0/Xj1aXZJviSJ2bm5yp9V9ZV15MLARLVA6UxodTnphfmZ+ag6MXZClM3qs9Y1VKGskD6iAGwNlmagaVMuxJMCRSqoBsMhTMLI+DvoaO4Db6rsD5A1I91kbt0JZnTKOvn9HYflHc371Gp/6BeWwLrnjp0y4jgzcw1mtW5Wh1rgaavqn3TiyJAkzQqngnmPDdGANVpaPpgACvzQF8RniZO42SxWIzSqlWV4zOz9UrM3cy11Wyb9dt0Vd6LK5zq1UrRCWSaCI9XZ5+Behzb0wAhIzqNqC6eaFQiExsg71MUdJYgiWRsnlysV6eV2vzSXBNN3rUpv7P5UJLbezQlSjRY0Bq5ddXJmUYr50PoUIY91c663t5F5xdOfL9eC9R9xAYLTPpJ+DHEe4VJNbhgYOPFXq/IrbszD9hPmD5WRjCtMNz/U85m+hRu1+bhGyfwdpYzxMVZNTqYX9JZKSX2D1lLZCwLWk9kjKBcAXgrmYNvDwHYz0H5phaVLto0yogaw7iJY6jxKSq2n2XExoXEJBTPBYcasqRAyimCGmICI3P6vRnY1Bmk/xJx+bEyeLqpdxx1dZg6NOuz9ROL1eOpgxMVHpX7iI3LZxmxdVmW+aXmwlJzxIaKFjRUJ9La1JdQ8IOt16i9nhuDDV2veSDNygQgpaz/ZnMt2/Zcz1F7WXft/qwxD9//KRWngvX/UqmQL6F8YWLqYOHh+v+DeB57NNcyrFxLddckV/eQrPdt1DN64EkapiSBQ1TZ/1x+YmI5f3ii0N0vwXhUnwtBRQA9W5+FaUAImwDYsdmlegiZBMhczX+HFwmMzYFxtEnUlbgzyNTXdbOSGWPTYwqE3ueC/QFwkQe3bdN2KhkKaquuDqMlyZ+BgTGYHGRm5o7PZ8Z97DHMUwYdPhwinK4uzs3MneBwaF2iWPXFxflFDgdkEkVoLJF5FYdCpBRBejxMnKsFKbqrtumP9poNssejPkHbWh47AO6Tjp7Yv+9ZeV9X3qehfSfL+06V9zX2j6+gZVrfFTTGRAR2sraVkbYkCabbLsyIFLyhpzp6TMwstRCXNIMXQ1EHmGMHCHeZMR+SQS/BdEtD+93cj9Zzuf3jPH4xgV8U488cb1T2Z/cj7PYg2VExgYICLHsuOnLkCF9eKn5RhB9Rla56juIAWwdgNHksLGX56ZUtdJTBihzsuwK8sgBvnFZk1XbQgQNGJX8YGUeC8uDliSfGxw8jzQ6UgLKEk0Gqm1wJxkpZzm8J8IoUryjGM1bR8jIaIwSR3PHozyJaWTmMvDXdwg5g37EQcLZqpOQyU3MVglyabelsKKL0sJ4Rf1ahi7EKE31M2dgMSvOTK5liPlvIZ4sTtImAk0d9dxLJ64gSQ0dzMPTlrL5pouLR7xQoV5xwOn6fRJnty3/evvDN4Pznft7Bz2/cvP7J379+89bVa4MrF279/lU0TVIyAQH9nOEhuorB6ke5jVYF9IWRlGUGAjWG6UUPyXYd7V/Oy0+tPPFcNvrvfsBZIwpaGPeruIzkF0E7o+QzaGVovd7/aPuLd2+9dW1w6T1WAbRz4fz25f+6+e3H269cHV6bDrN9KDO48c7gwsUoBVDlGC8+pzHTIWA6MxZv04yoGr5FRJlIydvXP7715Re3/vDK9n//GB04WkEJauOUF910dbFgIvRuffvazRtv4cYmJCkQieimySuuxywKYnR9zuJF1ejYFKHgj1Ig3YSi+zEXuyh8nKKvmEH2u1JQ/DDfvjZ/CqacdQUmpZVMtAy/WaAarFf4hftF31kdEmTueQ1QrAZpihW3JIF0t8+/F68zNTLD+mDY7WM1v4N+X2Ol3n3/j1ICOxBnLt0QJKpxp5YgysO9swhRuvfEMnR0S3fACVPwEiBMzrSEy2p1vLXKWIH5oR4ifaDvQC+3u6CmHgweWhvtV+UXq/IPQXtD3W2jMZodF6RqmtI1HMd2lJ6jrxrnYgWRSXjosVHlsrCzeGoGS6EsbyX1ig7zmTGSOYMqFfR4Jpd5PBjmA0RSd+qxMXpbubFNkm2Lkw7fAKIsptFyVGdDkJXpZYQCy02Z42SOd3B9Y0wSXU4WnF6f/+3gj28M3nzv9ruXBz+5NLj0q9uvXYLmZvpOearw8qEsnMP7SygZKgMGKdEIbO21XMJ7ZpOZ8VQKeCVBTICsJxSJy1PahYBSm51JJ2LYZG1CbtnnyqaKVw+HkPPXDcXkgm2XwjCW/PXYFBpsRTcXLO32OkPJ+evRYnLBinGwmLw+mS0Us8OEHl+nE1P2l0HYKkhyXWi9AK0zlS2MUBLeZd9jKWQbHYoogg4NK2GIqD2j28JhJWypsJzPTh7K5mVNbxmqNYQm2d4Tk6Q7v3QrbbE+W6826tlivjgp50tyvtDMF+QC/D//Q7nd668PkwzdABQXwgL26E7abrrvb3YNJRXZPxtC0V+cHEosWOXctTfh+L1GY1ZMTTV7hqXn7J5uua5ZnsiW4kqbWMSvRLYpeKPGRjJq0nbeujr43U+oYQus3eDKm9vn3ybTfHfNPqv08dQ/MJDUpi65dMU2j44wj/MoWpZlGJFUw0JHLNDSoyto2e7hfVN3JcNl5X/XaF63zAOBX9e34IPz7w9e+2r7wsvbly/gtUrEOL7y7ze/eSOaiaxf0kxvXx28/icOPY5o9xj1Vy5vf/a7VES8Ie/YGwC5/cuXt6++wiH+/evzg/Mf3f71J4Mrfxv8+k+DX7y5/e7n2xevDC5e+/vXFxKMeX1So+0PP925/AZHZuf1L7dffiVNOovMi0DzVIwxKcXEjZM4yh/8dPDLqzf/+jK4kYO3L+78x1e33/+f7Y9eu3X1Z2nF0VJUM1EMVUd0pO+YR/2Gofpz8/o7g6/eGVz+fPDbl+O5zuotEmiBjuC/NONpvYW2L18cvP7xzn9eHVz6PTpw86tPbn71i8HXl259887g1U+33/9ycAnYvrj95muDKx+Mx4m2bU2PU61hWIMGxdwBWf53/Zza7Zl6XNKg5qabAFGFC1oBZC+TXj4iHi+iCbyay9cOB+cKCIHi7l6er7YjcYY1U4CIp6x2b0PBuwkk+tmNeYstFfx0zXDiS3xu2zF6HkuJLJK5dt9p64QiJG2GiFu5MAA06YN9cnFw/svbr17cuXFl+73Xbl7/Es+exjb98mlmlM1mOQLdM5CC5B72HKOIbIDL7IbmW+5dEX07uysiHlh2RSKbNVxFHkM3r7+1feGdwZuvQodGpKo7v7kyuPEulQuYIRgk8CyyC9MKrOXX/gI5YrNLKqLB229uf/YpWCfOvV/FPHANsyXaW004/e3eSNnShJ8LXPGgnmnciDfBRuIoLWt6W++BL0HI6EhMCfOlK1XIET9R9ExXIYoyYpekoCGqRtGYe0EnRJUxkXsixYQC1HI09g5H5oAE0He+I0g7o28k02g0T8pKRTihb8420K2rr9z82x9AtQef/Wpw+U94wn3tC5h87/zyQ3BUQKlv//mTwADgh64gJ1qTtys0763X/rzz2TcwPqKwnIBS0E/HNrHYOFGpLZcIeuxAW6PVyeDa9c5q47zBU61KZnquUcZd/0n8I4ipeXJmoRxESkYW9iDLMbOvnzGsziy4kPK0vp6hYmfLQ07fAoPtdPEKH7QqY2WrzBoUwyItCZP25wLBgA45ropku++hTBhWRRqomJ88hIrhCtu9K9XRX0DyuVL+KSRb+ln4A8McjDpQaoIJ2V1Ti6UpJGs4cHFiqpTn6Mhuv/U8ZKnNVXwZISwkhIWUqBTRrvtSH5EUeVUXSxIv3RzFhEkfZNSZUTpyBNXnj0vLIKkVSTNwHGinb7hruqZg3w5VsAwl+E/Rz3mQEXuDFIgBUs8BQ+8BwLIlQgRDVyQsLrC4VdObo0TAGqkWmJLl9YnhGGArjHYNCvEc8As8XFatWob5daMuQRWJ9w8wzegYnmo2jA6oeN/Rn4S0utU2emu6gwM18HsVDJmOXyTCuqZrz4QEqNSqfW9NwvW/txpHdI1XMr6NRI3Xdh2eCAs7CrCiTcYp49hm29q6T7pGuw2pDzhoIoblWjWh9gAT9S6ubrVq29HxrBSm/WB3aH87VCyFPVAkIEybI8IpI9UoAsLuYorQEiLCUlkNOgVfLWFHCc24aISgNp2bvgZDJrbAZAgeccgk+KrWNSyY/eoO7oNxd5ZD8VduAWUigdK1YaiHyTxHZzIViaNUigzhxD8H6FTETaZbQcxDF4zxoiNWsSE8yJ4yEvvRC3SFMEs9yZSR+M7GYBQQTo68w9zoiFHlqnHkCDYleBZVRiTKSgqkS2CHCAwMW1sv48BSV5c0vdXv+C/AIQ5y9F8lcLeIzmB9pgdB+QNsif4BmNDXdkHEvRGTVNPwWEcGJTZ1dZUOmFRxaSUOTrLwMZ87+ozOI31G5pSR35VfHxOyGqsbZeQ5fbocvwVVeV7HMWC62i0j3VJbpq6FIFIJcuCC9EdKmx3/kZDfAei6mgymgbxvkTUqwigZJytk9Y4CZBzZpsLIYjvGi+RQBdokSsPi15UejFGG6w+lTLj9lgnDLqos04BSsPF4ntrCYxUBYS8Q92ScZZmg+MLH0DJWWIHtCLYp/P4dR/ThIWLIXJlr34A/tJw5GsTpxvjkUqjTuvXkEE7j9mkIr3ErtRdu2ap19mjmyQybg6ewH+Md/q5AM+M+HdiP0PiHRind+OPZsW0purU+6oTJt7YRg++fA4/bWUwcnwgXmlc/067znMGln++89TkKySF+zQNvOr3+0a0bN/D8/tvfgvXd+eCn/OJtxPTSKSdfepCU2LPKZFh4bWLrM2Kkb39wafvyV6klxpeh/RhamCEl9jfRRHE8njF6snrUXOzAETlpNFqOufoPmtWl5kl2VkmYrSDIlgworpCOOwRxr5UhWU/Nz83g+PCgFNblhiLvtaTYIa4K2aMZgrRX+oljIaNmFFx6IG6hqUTWxP0Ho2ZM7RAczvT8qeoMuPnULkjccEidj7CTU98jvTckQFJKB4i+SwKFD39LacodA0hDtFl0aEuAHzIoAEpDNXlMCBbmiZUSB0spejwWAwjwQsoCoJSuvwmQNExlBUApXU8TICmmmvRfKaaM9N9gXBQMKZHNvWt/YQPk376kAwhZRo8OELF1Rj/xDkfNNHefDG50WAvGkGBtJBxYyZDKOpRf58Dtw4et4PV0/Ri9zEQK7jWp8HecSJKgD4pOViX3T4XHteK9NH4jiMR30M3wZUtK9M3NGARQRN1SfJZF2CPFZ1hSOuOmEB5Dj9OOw7ekRBdMnhAW9j7xuWBBxxOdiJSEnU58ZY6gv4nuypFEwTrCy24EMTmiW1lSIm8ER3ABHkNPBp3sdr9JSmBO2jUdohAO4b0HKREPace0hgS0DLtSQhjtIb4MYFhQx9DjzSlxQmnneVOilNJOkwrjbMRnG6Xp+rGlE5Umnhd/73RTqc6eAEk0T56qnGwUS1MSf2DMP1AtNAJlcYfnDlWDeszgU6LK0uJMEA8S3lxAKCeNXMolBn4IFr3EgJw6JcU3Z0HMc9Vjs/XpCpnsB9DIMe7ICW6CggtrLFRrdTapl4DR+tyJmbk6xysGEoMV4hA7E0S3AAAfy40Ahpv6aTpkVMhJ3Wfm5k8D59A+oMELJyktPz4skTrcLCWwcSn4yLRE5aPUoKMsPkulRH8rkJNGFM/VlhYXwSw9WymwUaZWrZ2sk6sO2LVZuXJivHmaJuFCcgWf5rHFeUxz9JwTfk4QFL6K4VgV9HZueuTcfm/2z7ISIQ49ItmcXwAhzS8tVKbZZQL+NRAESpv8RF93PTZ8+Fc/VLj7HmgKqINystlcaFR8SNr9E/xwFBmnhWMRb6LENSJhd0/h6rArKpqL1ZovecEVDz4a04bGs41m/VRwABjKAd0/QbVj5DsvRrqjY093cwy9kyPQenwH07Fqo15pd7WW0nHU3lqYuFj/t6WZxTqmKe4pASja3ULMoOfgobo6o1QXZgjP/DspXgodK19A1GL6jiJJBmxOfHR5sHwIyy9lVYlzURPLSnTbRAkWLmPeceAFR3xjzmdO844H538zuP4V+p7uNQjdaEQL2yugx3cVto/g11LRdH71KbHtJLN8OAtPIrLRRDenREEC0XPEfJ4xoTtDFvSR7MaPO/OFyZDWVlFibIjg4CVJJJqZ4it8/Dm9aCbKUWGry6qmIWaC8KU5dNvTrfirko+j4O62Ctm+4tlw9J5ptFW3UkDcNWwV0+gaHgmeMqAqjlaxTS2Sr6uekzHBYr7L3lrsBqrJQ6WDUyTiC0PxBU79ru64FbmQINB1O7JrvKjjtADiRt/knu74dfLvt4oQ0vo9XT5rWJp9tlIiCmHLqonvFHJs0+z3KETTrQ34Y0INOUCv73R0fuMOvfRSuKwv6j2BCiOq03zn6WoKCYfbY6/J2T0v1zojk6hazEig+6mxZzQ04wC8kB30zFg+Mx5EaaT1wXjgKD6QGSuIw7726c0bl2k4VpkPSdstEi2+Uvwo2wMNO5/gutzU+CIujk6YLUI4GeIUC/OLMhorgOYWLKwnc0WkljxvESUURDQJxJTcw00WJvKP4wnhHTVc18ikTYQziSQuf7x6iRWTXcRB5a6l6QSvY9tvXBhcYudPghEhmFpwJ9G2UC+9b0bUm8bf7kIM2wQtpOKaut5DJcp4bADkqze0SqGFCDtY2L9Y1DYebF//cM+dLSIzEmVNQ6vLojDXWHMkw4ArIz5cHnqsnhzJ36qR+4Nnpuvo1pVvb79/hZ6mK7PT83ddDELThH0sBnzdwFZQn3gJFBsHXS+QXeMAP1g4E+fAEdXxLOGqWnoePwp7cPVnOx9h2W/Sqw62xKszYkLzPd0iDAioJJdu7kKobDwy43GUoJ2KY9tectgRGG7Si/0c+IAc7oLsVOYBE5Suirh0fhwdT9kT9LX4gx9vv/9RypkH/KQEWPQcw/LARj5n7ZOLeRftkwtF7i+BFP2/z+EzlnR1FX74WgE/g9aG341mtbnUYEC/DU9PAyBsDniNlD5q2TJ5gh+Rn7IoXQjg2gXfk2CRACtkWNG2yT2ei1yUsExbj2KzloPxxTOsPr8VShxvfLMDNjnMl2B5xmNo/BYxRdkKd4ZDtHDcjGPHd5PDPGf1FolfqWTkJDlNT0ujpq+SwUcHeromysriJ8AtEuTH0VeUfiw5+DHKXjd+ggqMHSCHrzM/ItO8TCRjxM1E7b4HTbS/sh/oF3Hr0B4uc3LHT1j/gHS4HXCX9LkbLQQ1jjWkuOIxGQc8DtlByoho35FsIu0XLzq5OH5vCk4RmtjToK4v03+hA9sjUzY6hsOk1sJhv1Ge6Gn+F1BWIH6/B7CciQPDES73ar7AEBCfx1fusgyCoG5QoJUhjLISpIZKwWXjG4yB2aSe3Y7ieyvBbMru3ePJVHJ843zZoRcLCP26m3+9SKMFh10nkPT34kfzElMxoQMt1jEspNH90Gt/oYUHMmYHqv6pxBzGdQ4ufjH4/GeJE44JedMrkcB87Hx85daVT2iG76IDG7m5cfDbSLC000VH6P0EnrcRVHCZBWhCcgY9WkGZDTIRjwGfzSRvDYhoxKX3tr88v/3ORZgHxOqYT85qR1cOzT5rIXndz0YvV8bLZs6qgMaIGkSlw695QM//p1Ig1ipCUmzuted+2nOxwDCNQFSiC6CSCbGLQ2LiGXuM3EBVSAglPN68e5WJu9TVwuZy14xVL47htynfoqHrFjnpE3ptXHOeXcPLB8uU5w5oNukTnNPKLqIrRC6hw48/u42O//iJB2bwD6kEKibg3KVylDg9A5wkHo1Vubsy/OOwyVJCEd5VAcH52mQJXHPcRRGPJwnH7//Z+fDTwaUfb7/7ORjYgqighEr6D6eaKSwEN/0F3kLYCcDadrUMAkNruoK1RDIR3s2q8veMYZ3axcwMvn319sfX6ZHrcPWF1p6LVh25EzLdJ/XgtJ8sKEcFHzLqa47YN8dPMK7dunqNnhYXHFO/ff1XMOaVyUHt8TIMdz7d+HjHP+GUh3MQMYWtCCrniEZ5D3RyT8yLjsP77ONj5YT9gPQw/rmJFe/OYiJDa8Bsgr+cUOFaQYTHTda4KkfnUP6+Qah6kXSuD2Bfb1yQ2e7tnpc5esns/pH6EUrHA72ofDJ92TV/zICIjAe5Fgxfq9XVomRSTIfAbPAXg7IBF1h7OpN2f+/dPuxW4vtEnT57+P7jwdLkBMoXisWJgw+///ggnviV1vejjL23/2R+Iv+w/R/EE//Q1v0o4w7av5AvPWz/B/FEP1Nwf8rYe/tPlCYLD9v/QTypn6m4h2Xkh37/F3r7RDG8/79YxN//PVjMP7z//0E8as/AX5Bgh36DU8Hsi3UwHwm+ejl1aCojSfQAY/AFYIW+049QeBs9vRx+hgIUywJ9wvfI4r25MvvMDF2hoSFREVjfMcXf4cAw5iTH+STl+Eefk+HMOBkfNPaz40szPL2zUSYnbYPTZyw1Ags/MkYP5Q79dgl/JDfltAc+1m65q7bTpZ9IVh1XV/B3EUlBVHSO3lXJarhh9frB14FlXtIYxGSOXqLpWVThyD16IMs+CTAOrWVY9Isi66aCf/PtpJuq6xltV1ed9hpdQ+BLxZ/UC4jSOYmlkc9thh9skxOfWwkib3P0I4+5SCk5phfdHlYu8tm2zosGXf8XfCQpaGx63B+DXujrzoafrnTdDjS9bmpl/0sRfgq+JsBPwr+h93Z7fiINjqHJUBng1FOttq4Y2pPsSigsoX90z3wwT/qHVu9dGbvY/3y+dDBm/6fyB4sP7f+DeGqL9Wqzjvyocfad9cNSHE7D5Q//o9l9+NzjZ+gnre5RGbv5f6WDpXj/n3z4/acH8yx3TLulmoqndtwVSVqGMdTy8D0f/hcG8bZEidzr49h9S1M4OPPBaKS+0uqvroL/RGLvIZEGu0Pyqtl31/zUs2u6pazi0JAge9s2TeYmPm94QByXmCcl0qw8J0UOHscmVwXBq+8tvNA3dC94l5aXqX+TxT4LsIm/6443LosruLr+52P9TzUD1bJ/0yteyVfY1xVxQoGWd9YxcIB0Ao4/AdSytQ0FHw7A8IniKeNYhuPAj5cmZwuC4tnVNfhKfcEX6uTAJ6ZfgQyCfBX/yETkMpfHCRK4S31d6UDL9TAjLDEomopN9cCBJt/pxjiGBdI9hxP8a2cwNMpT8EU/mVy1QTaOg1MfCezgY35y5HYaV2/3HT3UAxJpruLsCT+eyA6ETIRHGdRaRG4wZ4gJjfsYoDzspBuVIq483v/GxcZucSc8njF6io+jkPBqfFtRwLN+rm32NV0Jjp4oPds02hu4O/EabuFkhYQP4RApKAz7vZl/dOd/+Dx8Hj7/0s//Alwwty8AjgAA
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
