#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
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
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
