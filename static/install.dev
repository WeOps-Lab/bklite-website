#!/usr/bin/env bash
set -euo pipefail
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to log messages with colored output
log() {
    local level="$1"
    local message="$2"
    local color=""

    case "$level" in
        "INFO")
            color="$BLUE"
            ;;
        "WARNING")
            color="$YELLOW"
            ;;
        "ERROR")
            color="$RED"
            ;;
        "SUCCESS")
            color="$GREEN"
            ;;
        *)
            color="$NC"
            ;;
    esac

    echo -e "${color}[$(date +'%Y-%m-%d %H:%M:%S')] [$level] $message${NC}"
}

INSTALL_PATH=/opt/bk-lite


export PAYLOAD=$(
cat <<EOF
H4sIAF9qb2kAA+09bXvcxLV81q8YFqeJAe2bvU7YZFM2603i4ti+3nVTrnH1yCt5LaKVFknrxJh9HmhLSYAQWgq0NL1AC729vZeEW+5DWkLgz2Tt5FP/wj3zImkkjdbrvHFvG7U4qzNnzsycOefMmZkzo2zukfv+5PP5g6USIv9O0X/zxUn6L3tQoVSYmJiaKB0sTaF8oTBRmHoEle5/1R55pOd6qgNV0R2jNQwP0NbWhqSzdgT//j95sjnNbp3RHblld7q2q2c31Y55j8sAfkxNTqb1f2EC3lj/A9rBIvR/qZAvPYLy97gewuefvP8t3TtrO2fcsoSQpm/gf+CHY2zoThmtOobW1iVpwzZ7HZ3gOLpmkB+W6pF/N4yWZzuGKnd0D1hIYCBIXtvRo+mm3SaANdU8YzvaKv7dMSzDLkuSqzuARzO0TLunyYam07oYHbWtQ1XOmIan54JEkqZbG8qaYTJMhGSUBRB54arMUnIt21rLtXQH6p3TvRb76dg+KcOxrY5ueX6e2vx0vVFf/GF9UVmoNhqn5xeny2hsSwDusxzzC/U5nBzBTwApdtd2PK56lK6yML/Y7JcP5Q/luZTT9WMsAVSFJvDdRtGg8/juCRg3tjU9X3sGKjtzqnqirizWp2catAbQQSD6Xhmp5ll10xWzjRLMaaqnEhiYiY5qaSFChmDIuAd1JxOCZdnRX+gZjt5VXZeDj22RKoTcoGnrump66611vXXGp+1B/cpoOVM7NZ150i+nZRr4RV7Hf027pZrrIGwE1MV/pyYOPkXeVPw3WRgAu4bVzqywQgzLg5qrZhlN5F2/YKOj2z0ouxCAHCzcwBc0MYT9nFaksX+u2twL95nQYqrkTxa/UumNwZgYiyWd4EbEHeORupK0lJ6VW1y/CQrNDOeFyDKk8eWHM7Xm/OJMVTlVby7O1PbCo0QxuThEHiK9suwCLlRpGnAWVG+9Is4ekex1z+vOGq6nW1VNcyr5LPlf+dBk8VBMAwDFM2xrAUYXW6sUpg6t8wgd9dysuqqbLqQ3QehAiUDIKqDlw1iLf2l6V7c0V7GtcqQ/pZj1TeP3wnyjeWKxzvgsMH4+grIEtq4c0Iyn8oYuAfTN4sKJ6WqzWkbEiuQipBK9GVRegMwJtw/PwQDiaatZ9wWz7Hsy0Apns2uDZsssVePQdmHs7nao21YM19FVbZPYmSVqZyL8mqueqvcFJqaQNDGlFAuTFH3RWLqbOs3OnxiiSulcSFcyUnJuA/8j1iiBPgXIJB3e2rpz3HY6qld53rWtMMmwQAO8LFYLw9Ibxov6sU3gfqXAZglS6DKkt/3UzNzMfHqjBbJOciiL8/NNJu1jWzFQP4nJS74A3I9wB9HhkWoAksHZtlzb1GUVzIfuuihTfgoc4YyY97TF4RB8N8Lb6jkmEds1/BfbsXIuVygeJBasgGuRz5HycpRWjgr6CuG8uWbaZ4eyfvb47PzpvlgwaPbglXIk7HsZj+PBKzOpXDL2l0LTWSjlfSNJk1dV0H1LI9Knyz3HSFiUF8wnuu5my+62i9DmwM6I7NbTQWppcqKYi9VclkGmjDW15cHQAOw1wPAanBi7E0Cf5gkxc1x20vQwSSSqiOj7sL4WyLGMqqcbSrVWqzcayjP1Z5WZ6UqqKFPkRr22WG9yeSpDpNnPNF0/Xl2abYIveWJmfq7Sc2VddT25ECBROVAaE0p9bnphfmYOil6crTBxo/L8lO/KJoeygPuIAbA0WZqBuUxVCeYKChXQTYbCmYUR8PegKG6DVxWmA0T8mIrcpSvJnEZZP6e3eiC8u3mPSv1H9doSWPfUoVtGBG9mrtGsztXqWAo0fU3tmV4UAbqkUfFMMOe5MQKoTkPXBwNYmQf6gvA0cRoni8VilFatqhyfma1XYu5mrqVmW0xv00V5L65wqlcrRWeWaSw8Xp19BtpxbE8DhIzoNKK6eKJRiUxsgLxPUaAsQRLJ2Dy5WK9OK7X5pbkmmrxrU35n86Fkbe/RlCjRYUFv5DZUJ2caqzkfQocy7Km2N/TWLjK/cOKH9Vog7iN2WGDST8KPId4rTKrBBQMbL/Z6RW7dnXnAfsL0sTKCaYXh/p9yNtOncLt2D985gbeznCEuzprRxvUlykopsX/IIiOrsqD3RMYIyhWA+8kcfH8IwH4OWm9qUelqTqOMqDGMmziGGp+iYvtZRmxcSExC8VxwqCFLMqScwqghJjAyp9+bgU2dQfovEZcfC4Onm3rbUdeGiUOzPls/sVg9njo4UeZRvo/YuXyWEXuXZZlfai4sNUfsqGhBQ2UirU99DgU/2HqN2u26MdjQ9ZoH0q2MAdJ3vQL98Pkun2xu1bY913PUbtZdvz9lDN//KxWnJqf8/Z9SoVhA+cLE1MHJh/s/D+J57NHcqmHlVlV3XXJ1D8l6z0ZdowsTBsOUJPB7K/ufy09MLOcPTxQ6+yVwO+pzIagIoGfrszDbC2ETADs2u1QPIZMAmav57/AiwZhyYBxtEatEvFZk6hu6WcmMsVUQCgQj68IwA+AiD27Zpu1UMhTUUl0dnCKSPwP+TzAHzMzMHZ/PjPvYY7hOGXT4cIhwuro4NzN3gsOhbYli1RcX5xc5HOBJFKGxRKbPHArhUgTp8TBxrhak6K7aoj9a6zbwHjt3BK2/PHYAvGQdPbF/37Pyvo68T0P7Tpb3nSrva+wfX0HLtL0raIyxCIbDWj8j9SVpQ3dcmPgqeENXdfQYm1lqIc5pBi+GrA4wxw6Q2mXGfEgGvQSzag3td3M/3sjl9o/z+MUEflGMP3O8Udmf3Y+wd4tkR8UECgpU2XPRkSNH+PJS8Ysi/IiodNRzFAeqdQCchsfCUpafXumjowxW5GDfF+CVBXjjtCFrtoMOHDAq+cPIOBKUBy9PPDE+fhhpdiAEtEo4Gbi6xZVgrJTlfF+AV6R4RTGesYaWl9EYIYjktkd/FtHKymHkresW9vN7joWgZmtGSi4zNVchyKXZls48DkoPyxmZtih0zV1hrI8JG5soa35yJVPMZwv5bHGCdhHU5FF/1oDkDUSJoaM58HByVs80UfHo9wq0Vhxz2r5Oosz25T9vX/hmcP5zP+/gFzduXv/k71+/eevqtcGVC7f+8CqaJimZgIB+zvAQXaxi7aO1jTYF5IWRlGUGAjGGWWQXyXYd7V/Oy0+tPPFcNvrvfsBZJwJaGPebuIzkF0E6o+QzaGVou97/aPuLd2+9dW1w6T3WALRz4fz25f+6+e3H269cHd6aNrN9KDO48c7gwsUoBRDlWF38msZMh6DSmbF4n2ZEzfAtIspESt6+/vGtL7+49cdXtv/7J+jA0QpKUBunddFNVxczJkLv1rev3bzxFu5sQpICkYhuGr/icsyiYEaX5yxeO4+OTREK/igF3E0Iuh9zs4vAxyn6ghlkvysBxQ+bwtXmTy3MN+pK7dR0JRMtw+8WaAbTCr9wv+g7a0OCzD1vAYq1IE2w4pYk4O72+ffibaZGZpgOhmofa/kd6H2NlXr3+h+lBHYgXrl0Q5Boxp1agmgd7p1FiNK9J5ahrVu6A06Ygld6YQ6uJVxWq+2tV8YKzA/1ENGBngNabndATD0YPLQW2q/KL1blfwXpDWW3hcZodlyQqmlKx3Ac21G6jr5mnIsVRNZaQo+NCpeFncVTM5gLZbmflCs6zGfGSOYMqlTQ45lc5vFgmA8QSdupx8bo9XNjWyRbn+MO3wGiLKax6qjOpiArk8sIBZabVo7jOd6o940xSXQ5XnByff53g39/Y/Dme7ffvTz46aXBpV/ffu0SdDeTd1qnCs8fWoVzeBsRJSOiwCAlOoEtsZdLeGt0MjOeSgEvGIkJkGWjInF5SrsQUGqzM+lEDJssQcmr9rmyqeJF4iHk/OVhMblgd60wrEr+snsKDbZwnwtW8LvtoeT8bQcxuWBjINgz2JjMForZYUyPL8eKKfurXWyxK7n8t1GA3pnKFkYoCQdT7LEUEi0BRRRBhoaVMITVntFZxdFDbEW4nM9OHsrmZU1fNVRrCE2yiysmSTf46Y7pYn22Xm3Us8V8cVLOl+R8oZkvyAX4f/5f5Va3tzGMM3SfV1wIC9ikG6a7yb6/pzmUVGSbdAhFfw16KLFgMXtXbcLxm43GrJiaanYNS8/ZXd1yXbM8kS3FhTaxV1OJ7EbxRo2NZNSk7bx1dfD7n1LDFli7wZU3t8+/Tab57rp9VunhqX9gIKlNXXLpwnweHWEe51G0LMswIqmGhY5YIKVHV9Cy3cXb4+5KhsvK/67RvG6ZB0J9Xd+CD86/P3jtq+0LL29fvoCXpBGr8ZV/u/nNG9FMZJmaZnr76uD1P3HocUS7y6i/cnn7s9+nIuK4C8feBMjtX728ffUVDvHvX58fnP/o9m8+GVz52+A3fxr88s3tdz/fvnhlcPHa37++kKiY1yMt2v7w053Lb3Bkdl7/cvvlV9K4s8i8CDRP2RjjUozdOImj/MHPBr+6evOvL4MbOXj74s5/fHX7/f/Z/ui1W1d/nlYcLUU1E8VQcURHeo551O8YKj83r78z+OqdweXPB797OZ7rrL5K4mnQEfyXZjytr6LtyxcHr3+8859XB5f+gA7c/OqTm1/9cvD1pVvfvDN49dPt978cXIJqX9x+87XBlQ/G40RbtqbHqdYwrEFjn+6ALP+7fk7tdE09zmkQc9NNgKjABb0AvJeJlo+Ix7MIh1xHWoeDswWEQHB3L88X25FqhiVTgIinrHZ3U8GbRiT63Y15i6sq+Oma4cSX+NyWY3Q9lhJZJHPtntPSCUVI2goR+7kwzjfpg31ycXD+y9uvXty5cWX7vdduXv8Sz57GtvzyaWaUzWY5Ap0zkILkLvYco4hsgMvshuZb7l0RfTu7KyIeWHZFIntyXEMeQzevv7V94Z3Bm6+CQiPS1J3fXhnceJfyBcwQDBJ4FtmBaQWW8mt/gRyx2SVl0eDtN7c/+xSsE+fer+E6cB3TF22hJ5z+VnekbGnMzwWueNDOtNqI9zpHqlFa1vS+3kO9BJHBI1VKmC9dqMIa8RNFz3QVIigjqiQFDRE1isbcCzohqoyJ3BMpxhSglqMhljgACziAvvc9QdoZfTOZRoO2UlYqwgl9c7aBbl195ebf/giiPfjs14PLf8IT7mtfwOR751cfgqMCQn37z58EBgA/dAU50Zu8XaF5b732553PvoHxEYXlBJQCPR3bwmzjWKWuuoTRYwdaGm1OBreue1Yb5w2ealUy03ONMlb9J/GPIHTqyZmFchAQG1nYgyzHzJ5+xrDas+BCytP6RoaynS0POT0LDLbTwSt80KusKv0y61AMi/QkTNqfCxgDMuS4KpLtnocyYfQc6aBifvIQKoYrbPeuVEd/AcnnSvmnkGzpZ+EPDHMw6kCpiUrI7rpaLE0hWcPxqRNTpTxHR3Z7q89DltpcxecRwkxCmEmJRhHpui/tEXGRF3UxJ/HSzVFMmOggo86M0pEjqD5/XFoGTq1ImoHDfds9w13XNQX7dqiCeSjBf4p+zoOM2BukQAyQug4Yeg8Ali0RIhi6ImF2gcWtmt4cJQLWSLXAlCxvTAzHAFthtGpQiOeAX+DhsmrVMsyvG3UJmki8f4BpRtvwVLNhtEHEe47+JKTVrZbRXdcdHI+D36tgyHT8IpGqa7r2TEiAcq3a89Yl3P57K3FE1ngh4/tI1Hkt1+GJsOiyACvaZZwwjm21rP59kjWqNqQ94KCJKizXqgmxB5hIu7i21aotR8ezUpj2g92h+naoWAo1UMQgTJsjwgkjlSgCwu5iCtMSLMJcWQuUgm+WUFFCMy4aIahN56avwZCJLTAZgkccMgm+qnUMC2a/uoN1MO7Ocij+yi2gTCRQOjYM9TCZ5+hMpiJxlEqRIZz45wCdirjJdCuIeeiCMV50ki42hAfZU0ZiP3qBrhBmqSeZMhLf2RiMAsLJkXeYGx0xqlwzjhzBpgTPosqIBNNJAXcJ7BCBgWFr6WUcP+zqkqav9tr+C9QQx7L6rxK4W0RmsDzTg8D8OcWEfgAm6NouiFgbMUk1DY8pMgixqatrdMCkgksbcXCSRQn6taPP6HWkz8g1ZeR3ra+PCVmNtc0y8pweXY7vQ1Oe13EMmK52yki31FVT10IQaQQ5V0P0kdJmp7wk5CsAXVeTcWxinx7o1h0yQlbIuh0FkGQVxhTbMV4kp2bQFhEXdkBB6cLoZLj+IMrY2ls1YcBFlWUaMQzWHc9QV/EoRUDY/8M6jLMsExSf7RhaxqIqsBrBBoWv2XFEHx4ihpUrcz0b1A8tZ44GgdixenIp1F3tPzmkpnHLNKSucfu0l9qy9ers0cyTGTb7Tql+rO7wdwW6GWtzYDlCsx+ao3Szj+fFtqXo1saoUyXfzkZMvX8DQNzCYuL4LgChYfUz7TrDGVz6xc5bn6OQHOJXO/B20+sf3bpxA8/sv/0d2N2dD37GL9tGjC6dbPKlB0mJ3apMhsVPJzY9I+b59geXti9/lVpifAHaD5KGuVFiZxNNFMfjGaNH50fNxU6UkaNko+WYq/+oWV1qnmSH0YTZCoJsyYjxClHcIYh7bQzJemp+bgYfAAhKYSo3FHmvJcVO6VXI7swQpL3ST5z7GTWj4LoLcQ9NJbImbr4YNWOqQnA40/OnqjPg4FO7IHEDIXU7QiWnXke6NiRAUooCRN8lgcCHv6U04Y4BpCHSLDqVJ8APKygASkMleUwIFuaJlRIHSylyPBYDCPBCygKglC6/CZA0TGQFQCldThMgKSaa9F8pJoz032BcFAwpkW29a39hA+TfvqQDCFlAjw4QsRVGP/EOR800R58MbnRYC8aQYFUkHFjJkMoUym/zFi2jL+HTdBXuthopuNGmwt9uI0kCHRQdnUvunArP48W1NH7li8Qr6Fb40pcSurkVgwCKSC3Fh5WEGik+pJSijFtCeAw9TjsO70sJFUweARdqn/jgt0DxREdeJaHSiS9LEuib6JYkSRSmI7zNSBCNI7p2JyXmRnDGGuAx9GS4yW4X2KSE5KTdwyIK3hBebJES65B2Dm9IKMuwO0OEcR7i2x6GhXMMPb+eEiGUdmA7JT4p7biwMMJGfHhVmq4fWzpRaeIZ8Q9ON5Xq7AngRPPkqcrJRrE0JfEnAv0T80IjUBYrPHdqHsRjBh8DVpYWZ4JIkPBqCkI5aeRSbqnwg6/oLRXkWDEpvjkLbJ6rHputT1fIND+ARs7pR47oExRcWGOhWquz6bwEFa3PnZiZq3N1xUBisEIcYmeCuBYA4HPXEcBwUz9Nh4wKOYr9zNz8aag59A9I8MJJSsuPDEukDjdLCWxcCj4TL1H+KDVQlMVnKZfobwVy0ljiudrS4iKYpWcrBTbK1Kq1k3VylwW7Fy1XTow3T9MkXEiu4NM8tjiPaY6ec8LPCYzCd20cq4Lczk2PnNvXZv+wMmHi0DOwzfkFYNL80kJlmt0W4d/zQaC0y0/0dNdjw4d/t0eFu9CDpoA4KCebzYVGxYekXTDCD0eRcVo4FvEmStwiEnD3FG4Ou4OkuVit+ZwX3OHhozFpaDzbaNZPBSe8oRyQ/RNUOka+1GSkS1j2dPnK0EtXAqnHl2wdqzbqlVZHW1XajtpdDxMX6/+yNLNYxzTFmhKAouoWYgaag4fq6oxSXZghdebfSfFS6Fj5DKIW03cUSTJgc+wLryA6lM8X0haWOC81sbJE90yUYNUy5iAHjnDEPebc5jQHeXD+t4PrX6Ef6F6D0I2Gs7CNAnpEW2GbCH5DFU3nF6ASe04yy4ez8CQiu0x0Z0oUIRA9K87nGRN6NGQ1H8lu/Eg7X5gMaS0VJYaHCA5elUSiySm+psmf1osmoxwVtrSsahpiVghfjET3PN2KvzD5OAru56uQvSu+Go7eNY2W6lYKiLtqr2IaHcMjkVMGNMXRKrapRfJ11HMyJljMd9jbKrtlbPJQ6eAUCffCUHxJV6+jO25FLiQIdNy27Bov6jgtgLjRN7mrO36b/DvMIoS0XleXzxqWZp+tlIhA2LJq4nujHNs0e10K0XRrE/6Y0EIO0O05bZ3ftUMvvRSu6Yu0JxBhRGWaV56OppBYuD1qTc7uernVMzIJqcUVCWQ/NfCMxmUcgBeyfZ4Zy2fGgxCNNB2MR43i05ixgjjsa5/evHGZxmKV+Xi03cLQ4ovFj7IN0FD5BHclpwYXcUF0wmwRwsn4pliMX7SisQJobsHaejJXhGvJwxZRQkE4k4BNyQ3cZGEiFzmeEN5DxKlGJm0unEkkcfnjzUssmuzCDsp3LU0meBnbfuPC4BI7fBKMCMHsgjuG1kfddN2MiDcNvt2FGLYJWkjFNXW9i0q04rEBkG/e0CaFFiJUsFC/WMg2Hmxf/3DPyhbhGQmxpnHVZVGMa6w7kjHAlREfLg89U0/O4/dr5PLomek6unXl29vvX6FH6crs6PxdF4PQNKk+ZgO+a6AftCdeAsXGEdcLZMs4wA/WzsQ5cDh1PEu4sJaexw/BHlz9+c5HmPdb9J6DvniBRkxovqtbpAICKsnVm7tgKhuPzHgQJUin4ti2lxx2BIabaLGfA5+OwyrIjmQeMEHoqohL58fR8ZRtQV+KP/jJ9vsfpRx4wE9KdEXXMSwPbORz1j65mHfRPrlQ5P4SSNH/+xw+YEkXWOGHLxXwM+ht+N1oVptLDQb0+/D0NADC7oDXSOmjli2TJ/gR+SmL0oUArl/wJQkWia5ChhXtm9zjucgtCcu09yg26zkYXzzD6vG7ocTxxtc6YJPDfAmWZzyGxu8SU5R+uDkcooXjZhw7vqEc5jmrr5LglUpGTpLT9LQ0avoqGXxuoKtroqwshALcIkF+HHpF6ceSgx+jbHfjJ2jA2AFy8jrzYzLTy0QyRtxM1Op50EX7K/uBfhH3DtVwmeM7fsL2B6TDHYG7pM9dZyFocawjxQ2P8Tio45BNpIyI9h3xJtJ/8aKT6+P3puAUpok9Der6MvkXOrBdMmWjYzhMai0c8xutEz3K/wLKCtjvawDLmTgtHKnlXs0XGALi8/jCXZaBEdQNCqQyhNGqBKmhUHDZ+A5jYDapZ1ej+N5KMJuyu/d4MpUc3zhfduitAkK/7uZfL9JQwWF3CST9vfi5vMRUTOhAi2UMM2l0P/TaX2jhAY/Zaap/KDaHQZ2Di18MPv954nhjgt/0PiQwHzsfX7l15ROa4fvowGZubhz8NhIp7XTQEXo5gedtBg1cZtGZkJxBj1ZQZpNMxGPAZzPJKwMiEnHpve0vz2+/cxHmAbE25pOz2tGFQ7PPWkje8LPRC7TxspmzJqAxogRR7vBrHqD5/1ACxHpFSIrNvfasp10XMwzTCFgluv0pmRC7NSTGnrHHyPVThQRTwrPNuzeZuEsdLewud91Y8+IYfp/yPRq6bpFjPqHXxnXn2XW8fLBM69wGySY6wTmt7Ba6QuQGOvz4s9vo+I+feGwG/5BGoGICzt0oR4nTA8BJ4tFwlbsrwz8LmywlZOFdFRAcrk2WwHXHXRTxeJJw/PKfnQ8/HVz6yfa7n4OBLYgKSoik/3CimVKF4Jq/wFsIlQCsbUfLIDC0pitYSyQT4d2sKn/JGJapXczM4NtXb398nZ63DldfaOu5gNWRlZDJPmkHJ/1kQTnK+LCivuSIfXP8BOParavX6FFxwRn129d/DWNemZzSHi/DcOfTjY93/BNOeTgHEVPoR1A5RzRa90Am91R50Vl4v/r4TDmpfkB6WP25iRXvzmIiQ1vAbIK/nFDhekGEx03WuCZH51D+vkEoepF0TgewrzcuyGx3d8/LHL1kdv88/Qil44FeVD6ZvuyaP2ZARMaD3AmG79TqaFEyKaZDYDb4W0HZgAtVezpzH+9oZpdP378CHtnT9z8PliYnUL5QLE4cfPj9zwfxxG8uvx9l7L3/J/MT+Yf9/yCe+PfU7kcZd9D/5PuvD/v//j/Rr1HcnzL23v8TpcnCw/5/EE/q10juYRn5od9/Bm2fKIb3/08cxN9/Plg8+PD+/wfxqF0DfyiEHfoNTgWzDxPClCT4uOnUoamMJNFjjMEXoBX6Tr814m129XL4tREQLAvkCd8ji7fnyuxrQnSRhkZFRWA9xxR/bgXDmJ8crycpxz/6nAxqxsn4uLGfHV+a4entzTI5bxucQWOpEVj4LTl6NHfoJ2r4g7kpZz7wsXbLXbOdDv1Etuq4uoI/f0kKoqxz9I5KFsQNq9sLvg4t85zGIMZz9BJNz6IKR+7RA1n2SYBx6C3Doh+O2TAV/JvvJ91UXc9oubrqtNbpMgJfKv5yYkCUTkssjXxVNfwun5z4qk4Qf5uj3/LMRUrJMbnodLFwka/ztV806BaA4FtYQWfT4/4Y9EJPdzb9dKXjtqHrdVMr+1+K8FPwNQF+Ev4N2tvp+ok0PoYmQ2Ogpp5qtXTF0J5kV0JhDn3XmvlgnvTv6d67Mnax//l86WDM/k8V8oWH9v9BPLXFerVZR37sOKJnOg5LcTgNmj/8XVf34XOPn6FfLrtHZezm/5UOluL6X8rnH+r/g3iW26a9qpqKp7bdFUlahjHU8vBtH/6HJPHORInc6+PYPUtTODjzwWiwvrLaW1sD/4mE30MijXeH5DWz5677qWfXdUtZw9EhQfaWbZrMTXze8IA4LjFPSqRZ+ZoUOXgcm1wVBK++t/BCz9C94F1aXqb+TRb7LFBN18PhwcpGcQU31/9KsP9FbqBa9m96xYv5CvuIJk4o0PLOOgaOkU7A8SeAVm1tU8HnAzB8onjKOJbhauCHTJPjBUHx7AIbfKW+4EOEcuAT0499BnG+in9qInKly+MECdylnq60oee6uCIsMSiask31wIEmn2PHOIYF3D2HE/zLZzA0Wqfgw40yuXCD7B0HBz8S2ME3G+XIHTWu3uo5eigHJNhcxdkTfjzhHTCZMI9WUFslfIM5Q4xp3Dcf5WHn3SgXcePxFjguNnaLO6njGaOr+DgKibDGdxYFddbPtcyepivB6ROla5tGaxOrEy/hFk5WSAQRjpKCwrDfm/mulf/h8/B5+PxTP/8L9gFvhgCQAAA=
EOF
)

check_install_path() {
    if [ ! -d "$INSTALL_PATH" ]; then
        log "INFO" "Installation path $INSTALL_PATH does not exist, creating..."
        mkdir -p "$INSTALL_PATH"
        log "SUCCESS" "Installation path $INSTALL_PATH created."
    else
        log "WARNING" "Installation path $INSTALL_PATH already exists, file may be overwritten."
    fi
}

check_command_exist() {
    local cmd="$1"
    if ! command -v "$cmd" &> /dev/null; then
        log "ERROR" "Command '$cmd' not found."
        exit 1
    fi
}

unpack_payload() {
  # 如果没有传入目录，就用当前目录
  local out_dir="${1:-$INSTALL_PATH}"
  mkdir -p "$out_dir"
  echo $PAYLOAD | base64 -d | tar -xzf - -C "$out_dir"
}

install() {
    cd "$INSTALL_PATH"
    bash bootstrap.sh "$@"
}

main(){
    for cmd in tar base64 awk docker openssl; do
        check_command_exist "$cmd"
    done
    check_install_path
    unpack_payload
    install "$@"
}

main "$@"

exit 0
